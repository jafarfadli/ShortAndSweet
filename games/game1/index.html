<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Challenge - Educational Mini-Game</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: black;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        
        #game-container {
            width: 500px;
            height: 800px;
            background-color: black;
            position: relative;
            border: 2px solid white;
            overflow: hidden;
        }
        
        /* Game screens */
        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: opacity 0.3s;
        }
        
        #start-screen {
            background-color: #0a0a2a;
            color: white;
            text-align: center;
        }
        
        #game-screen {
            background-color: #0a0a2a;
            display: none;
        }
        
        #end-screen {
            background-color: #0a0a2a;
            display: none;
            text-align: center;
            color: white;
        }
        
        /* Game elements */
        h1 {
            color: #4CAF50;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }
        
        h2 {
            color: #FFC107;
            font-size: 28px;
            margin-bottom: 15px;
        }
        
        p {
            font-size: 20px;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 20px;
            cursor: pointer;
            margin-top: 20px;
            border-radius: 0;
            font-family: inherit;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #math-problem {
            font-size: 48px;
            color: white;
            margin: 30px 0;
            text-align: center;
        }
        
        #options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }
        
        .option {
            background-color: #2196F3;
            color: white;
            font-size: 24px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            user-select: none;
        }
        
        .option:hover {
            background-color: #0b7dda;
        }
        
        .option.correct {
            background-color: #4CAF50;
        }
        
        .option.incorrect {
            background-color: #F44336;
        }
        
        .option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        
        #score-container {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        #timer {
            width: 100%;
            height: 10px;
            background-color: #333;
            margin-bottom: 20px;
            position: relative;
        }
        
        #timer-progress {
            height: 100%;
            background-color: #FFC107;
            width: 100%;
            transition: width 0.1s linear;
        }
        
        #feedback {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            height: 40px;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .incorrect {
            color: #F44336;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen">
            <h1>Math Challenge</h1>
            <p>Solve math problems as quickly as you can!</p>
            <p>You have 30 seconds to answer as many questions as possible.</p>
            <button id="start-button">Start Game</button>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div id="score-container">Score: <span id="score">0</span></div>
            <div id="timer">
                <div id="timer-progress"></div>
            </div>
            <div id="math-problem"></div>
            <div id="options-container"></div>
            <div id="feedback"></div>
        </div>
        
        <!-- End Screen -->
        <div id="end-screen" class="screen">
            <h1>Game Over!</h1>
            <h2>Your Score: <span id="final-score">0</span></h2>
            <p id="performance-message"></p>
            <button id="restart-button">Play Again</button>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let timeLeft = 30;
        let timerInterval;
        let currentProblem = {};
        let gameActive = false;
        let answerTimeout;
        let isAnswerProcessing = false;
        
        // DOM elements
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const mathProblem = document.getElementById('math-problem');
        const optionsContainer = document.getElementById('options-container');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('final-score');
        const timerProgress = document.getElementById('timer-progress');
        const feedback = document.getElementById('feedback');
        const performanceMessage = document.getElementById('performance-message');
        
        // Operation types
        const operations = [
            { symbol: '+', method: (a, b) => a + b },
            { symbol: '-', method: (a, b) => a - b },
            { symbol: 'Ã—', method: (a, b) => a * b }
        ];
        
        // Start game when start button is clicked
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        
        function startGame() {
            // Reset game state completely
            score = 0;
            timeLeft = 30;
            gameActive = true;
            isAnswerProcessing = false;
            scoreDisplay.textContent = score;
            timerProgress.style.width = '100%';
            feedback.textContent = '';
            feedback.className = '';
            
            // Clear any existing intervals and timeouts
            clearInterval(timerInterval);
            clearTimeout(answerTimeout);
            
            // Show game screen
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            
            // Start timer immediately
            timerInterval = setInterval(updateTimer, 100);
            
            // Generate first problem
            generateProblem();
        }
        
        function updateTimer() {
            if (!gameActive) {
                clearInterval(timerInterval);
                return;
            }
            
            timeLeft -= 0.1;
            timerProgress.style.width = `${Math.max(0, (timeLeft / 30) * 100)}%`;
            
            if (timeLeft <= 0) {
                endGame();
            }
        }
        
        function generateProblem() {
            if (!gameActive) return;
            
            // Reset processing flag
            isAnswerProcessing = false;
            
            // Clear feedback
            feedback.textContent = '';
            feedback.className = '';
            
            // Randomly select operation
            const operation = operations[Math.floor(Math.random() * operations.length)];
            
            // Generate numbers based on operation for appropriate difficulty
            let num1, num2;
            
            if (operation.symbol === '+') {
                num1 = Math.floor(Math.random() * 20) + 1;
                num2 = Math.floor(Math.random() * 20) + 1;
            } else if (operation.symbol === '-') {
                num1 = Math.floor(Math.random() * 20) + 10;
                num2 = Math.floor(Math.random() * 10) + 1;
                // Ensure result is positive
                if (num2 > num1) {
                    [num1, num2] = [num2, num1];
                }
            } else { // multiplication
                num1 = Math.floor(Math.random() * 10) + 1;
                num2 = Math.floor(Math.random() * 10) + 1;
            }
            
            // Calculate correct answer
            const correctAnswer = operation.method(num1, num2);
            
            // Store current problem
            currentProblem = {
                num1,
                num2,
                operation: operation.symbol,
                correctAnswer
            };
            
            // Display problem
            mathProblem.textContent = `${num1} ${operation.symbol} ${num2} = ?`;
            
            // Generate answer options
            generateOptions(correctAnswer);
        }
        
        function generateOptions(correctAnswer) {
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Create options array with correct answer
            const options = [correctAnswer];
            
            // Generate wrong answers that are close to the correct answer
            let attempts = 0;
            while (options.length < 4 && attempts < 20) {
                attempts++;
                // Vary the wrong answers based on the magnitude of the correct answer
                let variance = Math.max(2, Math.floor(correctAnswer * 0.4));
                let wrongAnswer = correctAnswer + (Math.floor(Math.random() * variance * 2) - variance);
                
                // Ensure wrong answer is positive and different from existing options
                if (wrongAnswer > 0 && wrongAnswer !== correctAnswer && !options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // If we couldn't generate enough unique wrong answers, fill with simple variations
            while (options.length < 4) {
                let wrongAnswer = correctAnswer + Math.floor(Math.random() * 10) + 1;
                if (!options.includes(wrongAnswer)) {
                    options.push(wrongAnswer);
                }
            }
            
            // Shuffle options
            shuffleArray(options);
            
            // Create option buttons
            options.forEach(answer => {
                const optionButton = document.createElement('div');
                optionButton.className = 'option';
                optionButton.textContent = answer;
                optionButton.addEventListener('click', () => checkAnswer(answer, optionButton));
                optionsContainer.appendChild(optionButton);
            });
        }
        
        function checkAnswer(selectedAnswer, optionElement) {
            if (!gameActive || isAnswerProcessing) return;
            
            // Set processing flag to prevent multiple clicks
            isAnswerProcessing = true;
            
            // Clear any existing timeout first
            clearTimeout(answerTimeout);
            
            // Disable all options to prevent multiple clicks
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.classList.add('disabled');
            });
            
            if (parseInt(selectedAnswer) === currentProblem.correctAnswer) {
                // Correct answer
                score += 10;
                scoreDisplay.textContent = score;
                feedback.textContent = 'Correct! +10 points';
                feedback.className = 'correct';
                optionElement.classList.add('correct');
            } else {
                // Wrong answer
                feedback.textContent = 'Wrong answer!';
                feedback.className = 'incorrect';
                optionElement.classList.add('incorrect');
                
                // Highlight the correct answer
                allOptions.forEach(opt => {
                    if (parseInt(opt.textContent) === currentProblem.correctAnswer) {
                        opt.classList.add('correct');
                    }
                });
            }
            
            // Generate new problem after a delay
            answerTimeout = setTimeout(() => {
                if (gameActive) {
                    generateProblem();
                }
            }, 1200);
        }
        
        function endGame() {
            gameActive = false;
            isAnswerProcessing = false;
            
            // Clear all intervals and timeouts
            clearInterval(timerInterval);
            clearTimeout(answerTimeout);
            
            // Update final score
            finalScoreDisplay.textContent = score;
            
            // Performance message based on score
            if (score >= 100) {
                performanceMessage.textContent = 'Excellent! You\'re a math wizard!';
            } else if (score >= 60) {
                performanceMessage.textContent = 'Great job! You\'re getting better!';
            } else if (score >= 30) {
                performanceMessage.textContent = 'Good effort! Keep practicing!';
            } else {
                performanceMessage.textContent = 'Nice try! Practice makes perfect!';
            }
            
            // Show end screen
            gameScreen.style.display = 'none';
            endScreen.style.display = 'flex';
        }
        
        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Add keyboard support for accessibility
        document.addEventListener('keydown', function(event) {
            if (!gameActive || isAnswerProcessing) return;
            
            const options = document.querySelectorAll('.option:not(.disabled)');
            if (event.key >= '1' && event.key <= '4') {
                const index = parseInt(event.key) - 1;
                if (options[index]) {
                    options[index].click();
                }
            }
        });
    </script>
</body>
</html>